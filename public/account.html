<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Account</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"/>    
    <link rel="stylesheet" href="style-hy/navBar.css">
    <link rel="stylesheet" href="style-hy/footer.css">
    <link rel="stylesheet" href="style-hy/account.css">
  </head>
  <script>
    (function() {
  // Check for SessionStorage data 
  var userData = sessionStorage.getItem("username");

  // If no user data in sessionStorage, redirect to login
  if (!userData) {
    location.href = "/login.html";
  }
})();
  </script>
  <body >
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <img class="logo-header" src="assets-henry/latest-logo.png" alt="">
        
        <!-- change -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span
            class="navbar-toggler-icon"
          ></span>
        </button>
        <div
          class="collapse navbar-collapse"
          id="navbarNav"
        >
          <ul
            class="navbar-nav ms-auto navbar-items"
          >
            <li class="nav-item">
              <a
                class="nav-link rounded-3"
                aria-current="page"
                href="index.html"
                >Home</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link rounded-3"
                href="products.html"
                >Products</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link rounded-3"
                href="contact.html"
                >Contact Us</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link rounded-3"
                href="account.html"
                >Account</a
              >
            </li>
            <li class="nav-item">
              <a
                class="nav-link rounded-3"
                href="cart.html"
                >Cart</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <main>
      <!-- START CONTENT HERE -->
      <div class="container-fluid p-0 min-vh-100">
        <div class="spacer py-2">
       </div>

        
        <div class="name header col mt-3 justify-content-center text-center" id="user-name">
        </div>
        <div class="account-container d-flex flex-row">
          <div class="history-container col-9">
            <div class="form-header m-3"><h3>Order History</h3></div>
              <div class="history-form m-3">
                <div class="history-labels d-flex flex-row text-left fs-4">
                  <div class="total-col col-2">
                    Order ID
                  </div>
                  <div class="total-col col-2">
                    Date
                  </div>
                  <div class="total-col col-3">
                    Order Status
                  </div>
                  <div class="total-col col-2">
                    Total
                  </div>
                </div>

                <hr class="my-2"></hr>

                <div class="order-history" id="order-history">

                  <div class="order d-flex flex-row text-left">
                    
                  </div>
                </div>
              </div>
        </div>
        <div class="customer-info col-3 d-flex flex-column ">
          <div class="header my-3">
            <h4>Acount Information:</h4>
          </div>
          <div class="address ">
              <h5>Your Address:</h5>
              <div class="address-content ms-4" id="user-address">
                
              </div>
          </div>
          <div class="email-section my-3">
            <h5>Your Email:</h5>
            <div class="email-content ms-4" id="user-email">test.test@gmail.com</div>
        </div>
        
        <div class="d-flex justify-content-center">
        <button id="signOutButton" class="btn btn-primary my-3">
          Sign Out
        </button>
      </div>

      </div>

      </div>
      </div>
    </main>
    <footer
    class="text-center text-lg-start text-white"
    style="background-color: #1c2331"
  >
    <!-- Section: Social media -->
    <section
      class="d-flex justify-content-between p-4 social-media-container"
    >
      <!-- Left -->
      <div class="my-2">
        <span
          >Get connected with us on social
          networks:</span
        >
      </div>
      <!-- Left -->

      <!-- Right -->
      <div>
        <a
          href="https://www.facebook.com/METAPCs"
          target="_blank"
          class="text-white me-4"
        >
          <i class="bi bi-facebook"></i>
        </a>
        <a
          href="https://twitter.com/metapcs"
          target="_blank"
          class="text-white me-4"
        >
          <i class="bi bi-twitter"></i>
        </a>
        <a
          href="https://www.instagram.com/metapcsonline"
          target="_blank"
          class="text-white me-4"
        >
          <i class="bi bi-instagram"></i>
        </a>
        <a
          href="https://www.youtube.com/metapcs"
          target="_blank"
          class="text-white me-4"
        >
          <i class="bi bi-youtube"></i>
        </a>
      </div>
      <!-- Right -->
    </section>
    <!-- Section: Social media -->

    <!-- Section: Links  -->
    <section class="footer-container">
      <div
        class="container text-center text-md-start pt-5 footer-body"
      >
        <!-- Grid row -->
        <div class="row mt-3">
          <!-- Grid column -->
          <div
            class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4"
          >
            <!-- Content -->
            <h6
              class="footer-header text-uppercase fw-bold"
            >
              META PC
            </h6>
            <hr
              class="mb-4 mt-0 d-inline-block mx-auto"
              style="
                width: 60px;
                background-color: #7c4dff;
                height: 2px;
              "
            />
            <p>
              We build high-quality and reliable
              PC's to match YOUR needs! Check
              out our higlighted products, or
              customize your own to your
              workflow.
            </p>
          </div>
          <!-- Grid column -->

          <!-- Grid column -->
          <div
            class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4"
          >
            <!-- Links -->
            <h6
              class="text-uppercase fw-bold footer-header"
            >
              Products
            </h6>
            <hr
              class="mb-4 mt-0 d-inline-block mx-auto"
              style="
                width: 60px;
                background-color: #7c4dff;
                height: 2px;
              "
            />
            <p>
              <a
                href="products.html"
                class="text-white"
                >Our Products</a
              >
            </p>
          </div>
          <!-- Grid column -->

          <!-- Grid column -->
          <div
            class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4"
          >
            <!-- Links -->
            <h6
              class="text-uppercase fw-bold footer-header"
            >
              Useful links
            </h6>
            <hr
              class="mb-4 mt-0 d-inline-block mx-auto"
              style="
                width: 60px;
                background-color: #7c4dff;
                height: 2px;
              "
            />
            <p>
              <a
                href="login.html"
                class="text-white"
                >Log In / Sign Up</a
              >
            </p>
            <p>
              <a
                href="account.html"
                class="text-white"
                >Your Account</a
              >
            </p>
            <p>
              <a
                href="contact.html"
                class="text-white"
                >Contact Us</a
              >
            </p>
          </div>
          <!-- Grid column -->

          <!-- Grid column -->
          <div
            class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4"
          >
            <!-- Links -->
            <h6
              class="text-uppercase fw-bold footer-header"
            >
              Contact Us
            </h6>
            <hr
              class="mb-4 mt-0 d-inline-block mx-auto"
              style="
                width: 60px;
                background-color: #7c4dff;
                height: 2px;
              "
            />
            <p>
              <i class="bi bi-house mr-3"></i>
              3259 E. Harbour Drive Suite 101
            </p>
            <p>
              <i class="bi bi-house mr-3"></i>
              Phoenix, Arizona 85034
            </p>
            <p>
              <i
                class="bi bi-envelope me-3"
              ></i>
              support@metapcs.com
            </p>
            <p>
              <i class="bi bi-telephone"></i> +
              01 833 638 2727
            </p>
          </div>
          <!-- Grid column -->
        </div>
        <!-- Grid row -->
      </div>
    </section>
    <!-- Section: Links  -->

    <!-- Copyright -->
    <div
      class="text-center p-3 footer-copyright"
      style="
        background-color: var(--secondary);
        color: var(--text);
      "
    >
      © 2023 Copyright:
      <a class="text-white" href="">META PCs</a>
    </div>
    <!-- Copyright -->
  </footer>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
    crossorigin="anonymous"
  ></script>
  <script> // SignOut Button Functionality
    document.getElementById('signOutButton').addEventListener('click', function() {
       sessionStorage.removeItem('username'); // Clear the username key from session storage
       alert('You have been signed out.'); // Alert the user
       window.location.href = '/login.html'; // Redirect to login.html
    });
  </script>
  <script> // Loading the Page's HTML
    window.onload = function() {
      const user_email = sessionStorage.getItem('username');
      const reqData = { email: user_email }
      fetch('/loadaccount', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(reqData) 
      })
      .then((response) => {
        return response.json()
      })
      .then((data) => {
        if (data.error) {
          alert(data.error);
        } else {
          if (data.success) {
            // User Info from collection
            const userInfo = data.userInfo;
            const userOrders = userInfo.orders; // Array
            const userAddress = userInfo.address;

            // HTML Elements for Account Info
            const nameElement = document.getElementById("user-name");
            const addressElement = document.getElementById("user-address");
            const emailElement = document.getElementById("user-email");

            //HTML Elements for Order History
            const orderHistory = document.getElementById('order-history');

            // Loading Account Info
            nameElement.innerHTML = `<h3>Welcome back, <br>${userInfo.firstName} ${userInfo.lastName}</h3>
                                      <hr class="mx-5"></hr>`;
            addressElement.innerHTML = `
                <div>${userAddress.street1}</div>
                <div>${userAddress.street2}</div>
                <div class="city d-inline-block">${userAddress.city},</div>
                <div class="state d-inline-block">${userAddress.state},</div>
                <div class="zip-code d-inline-block">${userAddress.zip}</div>`;
            emailElement.innerHTML = user_email;

            // Loading Order History
            for (const orderDetails of userOrders) {
              orderHistory.innerHTML += `
                
                <div class="order d-flex flex-row text-left">
                  <div class="total-col col-2">
                    ${orderDetails.orderID}
                  </div>
                  <div class="total-col col-2">
                    ${new Date(orderDetails.orderDate).toISOString().split('T')[0]}
                  </div>
                  <div class="total-col col-3">
                    ${orderDetails.orderStatus}
                  </div>
                  <div class="total-col col-2">
                    $${orderDetails.total.toFixed(2)}
                  </div>
                </div>
                <hr class="my-2"></hr>
              `;
            }
          } else {
            alert("booo");
          } 
        }
      })
      .catch((error) => {
        console.log(error);
      });
    }
  </script>
</html>
